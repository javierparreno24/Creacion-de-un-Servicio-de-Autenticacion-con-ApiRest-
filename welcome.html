<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bienvenido al Sistema</title>
    <link rel="stylesheet" href="styles.css"> </head>
<body>
    <div class="container" id="welcomeContainer">
        <h1 id="welcomeTitle">Cargando datos...</h1>
        <p id="userInfo"></p>
        <p id="currentTime"></p>
        <p id="extraMessage"></p>
        
        <button id="logoutButton">Cerrar Sesión</button>
    </div>

    <script>
        const token = localStorage.getItem('authToken');
        
        // 1. Verificación Inicial del Token
        if (!token) {
            window.location.href = 'no-permisos.html'; // Redirige si no hay token (Requerido)
        }

        async function loadWelcomeData() {
            try {
                // 2. Petición al endpoint protegido con el Token en la cabecera
                const response = await fetch('api.php/api/welcome', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}` // Envío del Token (Requerido)
                    }
                });

                if (response.ok) { // 200 OK
                    const data = await response.json();
                    // Muestra los datos obtenidos de la API (Requerido)
                    document.getElementById('welcomeTitle').textContent = `¡Bienvenido, ${data.username}!`;
                    document.getElementById('userInfo').textContent = `Usuario autenticado: ${data.username}`;
                    document.getElementById('currentTime').textContent = `Hora actual del servidor: ${data.current_time}`;
                    document.getElementById('extraMessage').textContent = data.additional_welcome;
                } else if (response.status === 403) { // 403 Forbidden
                    window.location.href = 'no-permisos.html'; // Redirige a error (Requerido)
                } else {
                    alert('Error al obtener datos: ' + response.status);
                    logout(); 
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                alert('Error de conexión o de red.');
                logout(); 
            }
        }

        function logout() {
            localStorage.removeItem('authToken'); // Elimina el token (Requerido)
            window.location.href = 'index.html'; // Redirige al login (Requerido)
        }

        document.getElementById('logoutButton').addEventListener('click', logout);

        loadWelcomeData();
    </script>
</body>
</html>


